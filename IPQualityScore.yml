commonfields:
  id: IPQualityScore
  version: -1
name: IPQualityScore
display: IPQualityScore
category: Data Enrichment & Threat Intelligence
image: data:image/jpeg;base64,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
description: This is the Hello World integration for getting started.
detaileddescription: |-
  ## Hello World
  - This text is markdown
  - Here you should explain how to configure the instance in Demisto
configuration:
- display: Server URL (e.g. https://example.net)
  name: url
  defaultvalue: https://www.ipqualityscore.com/api/json/ip/
  type: 0
  required: true
- display: API Key
  name: APIKey
  defaultvalue: ""
  type: 0
  required: true
- display: Trust any certificate (not secure)
  name: insecure
  defaultvalue: ""
  type: 8
  required: false
- display: Use system proxy settings
  name: proxy
  defaultvalue: ""
  type: 8
  required: false
script:
  script: |2

    ''' Created by Osama Shenoda contact osama.samaan.hanna@gmail.com '''

    ''' IMPORTS '''

    import json
    import requests
    import dateparser

    # Disable insecure warnings
    requests.packages.urllib3.disable_warnings()



    def main():
        """
            PARSE AND VALIDATE INTEGRATION PARAMS
        """
        ip=demisto.args().get('ip')
        baseurl=demisto.params().get('url')
        APIKey=demisto.params().get('APIKey')
        myip='{}'.format(ip)
        mypath='/{}?strictness=3&fast=1'.format(ip)
        myrequest=str(baseurl)+str(APIKey)+mypath
        r=requests.get(myrequest)
        r_j=r.json()

        human_readable_data = {
         'IP': myip,
         'TOR': r_j['tor'],
         'ISP': r_j['ISP'],
         'proxy': r_j['proxy'],
         'mobile': r_j['mobile'],
         'is_crawler': r_j['is_crawler'],
         'recent_abuse': r_j['recent_abuse'],
         'bot_status': r_j['bot_status'],
         'country_code': r_j['country_code'],
         'region': r_j['region'],
         'city': r_j['city'],
         'organization': r_j['organization'],
         'host': r_j['host'],
         'fraud_score': r_j['fraud_score'],
         'success': r_j['success'],
         'message': r_j['message'],
         'ASN': r_j['ASN']
                              }

        outputs = {
            'IPQulaityScore': {
               'IP': myip,
               'ISP': str(r_j['ISP']),
               'proxy': bool(r_j['proxy']),
               'TOR': bool(r_j['tor']),
               'mobile': bool(r_j['mobile']),
               'is_crawler': bool(r_j['is_crawler']),
               'recent_abuse': bool(r_j['recent_abuse']),
               'bot_status': bool(r_j['bot_status']),
               'country_code': str(r_j['country_code']),
               'region': str(r_j['region']),
               'city': r_j['city'],
               'organization': str(r_j['organization']),
               'host': str(r_j['host']),
               'fraud_score': int(r_j['fraud_score']),
               'success': str(r_j['success']),
               'message': str(r_j['message']),
               'ASN': str(r_j['ASN'])
                   }
          }

        headers = ['IP', 'ISP', 'proxy', 'TOR', 'fraud_score', 'ASN'  , 'region' , 'organization' , 'is_crawler', 'country_code' , 'host' , 'city' , 'recent_abuse' ]
        human_readable = tableToMarkdown('IPQulityScore info' , human_readable_data, headers=headers, removeNull=True)
        return_outputs(human_readable, outputs, r_j)




    if __name__ in ('__main__', '__builtin__', 'builtins'):
        main()
  type: python
  commands:
  - name: ip
    arguments:
    - name: ip
      required: true
      default: true
      description: IP Address
    outputs:
    - contextPath: IPQulaityScore.fraud_score
      description: ""
      type: number
    - contextPath: IPQulaityScore.proxy
      type: boolean
    - contextPath: IPQulaityScore.tor
      type: boolean
    - contextPath: IPQulaityScore.ISP
      type: string
    - contextPath: IPQulaityScore.is_crawler
      type: boolean
    - contextPath: IPQulaityScore.recent_abuse
      type: boolean
    - contextPath: IPQulaityScore.organization
      type: string
    - contextPath: IPQulaityScore.country_code
      type: string
    - contextPath: IPQulaityScore.region
      type: string
    description: test IPQuality
  dockerimage: demisto/python3:3.7.4.2245
  runonce: true
  subtype: python3
